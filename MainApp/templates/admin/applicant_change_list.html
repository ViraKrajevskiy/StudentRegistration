{% extends "admin/change_list.html" %}
{% load static %}

{% block content %}
<div style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-bottom: 30px; padding: 0 10px;">

    <div style="background: white; padding: 15px; border-radius: 4px; border: 1px solid #ccc; height: 350px;">
        <h3 style="margin-top:0; color:#666;">Абитуриенты по направлениям</h3>
        <canvas id="directionChart"></canvas>
    </div>

    <div style="background: white; padding: 15px; border-radius: 4px; border: 1px solid #ccc; height: 350px;">
        <h3 style="margin-top:0; color:#666;">Статус заявок</h3>
        <canvas id="statusChart"></canvas>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const commonOptions = {
        responsive: true,
        maintainAspectRatio: false,
        plugins: { legend: { position: 'bottom' } }
    };

    // 1. Столбчатый график
    const dirData = {{ direction_json|safe }};
    new Chart(document.getElementById('directionChart'), {
        type: 'bar',
        data: {
            labels: dirData.map(d => d.label),
            datasets: [{
                label: 'Кол-во студентов',
                data: dirData.map(d => d.value),
                backgroundColor: '#417690'
            }]
        },
        options: commonOptions
    });

    // 2. Круговой график
    const statData = {{ status_json|safe }};
    new Chart(document.getElementById('statusChart'), {
        type: 'doughnut',
        data: {
            labels: statData.map(d => d.label),
            datasets: [{
                data: statData.map(d => d.value),
                backgroundColor: ['#28a745', '#dc3545']
            }]
        },
        options: commonOptions
    });
});
</script>

{{ block.super }}
{% endblock %}